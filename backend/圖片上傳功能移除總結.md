# åœ–ç‰‡ä¸Šå‚³åŠŸèƒ½ç§»é™¤ç¸½çµ

## å·²ç§»é™¤çš„æª”æ¡ˆ

1. **`backend/utils/cloud_storage.py`** - Cloudinary åœ–ç‰‡å„²å­˜æœå‹™é¡åˆ¥
2. **`backend/test_cloudinary.py`** - Cloudinary é€£æ¥æ¸¬è©¦è…³æœ¬
3. **`backend/CLOUDINARY_SETUP.md`** - Cloudinary è¨­å®šèªªæ˜æ–‡ä»¶

## å·²ä¿®æ”¹çš„æª”æ¡ˆ

### 1. `backend/media/models.py`
- **ä¿ç•™**ï¼šæ‰€æœ‰æ¨¡å‹çµæ§‹ï¼ˆImageã€PetHeadshotã€UserHeadshotï¼‰
- **ä¿ç•™**ï¼šæ‰€æœ‰æ¬„ä½ï¼ˆimg_urlã€public_idã€original_filenameã€file_sizeã€content_type_mime ç­‰ï¼‰
- **ç§»é™¤**ï¼šæ‰€æœ‰ Cloudinary ç›¸é—œæ–¹æ³•
  - `get_transformed_url()` æ–¹æ³•
  - `delete_from_cloudinary()` æ–¹æ³•
  - è‡ªè¨‚çš„ `delete()` æ–¹æ³•
- **ä¿®æ”¹**ï¼šimg_url æ¬„ä½å…è¨±ç‚ºç©ºå€¼ï¼ˆ`blank=True, null=True`ï¼‰
- **ä¿ç•™**ï¼šåŸºæœ¬çš„ `url` å±¬æ€§æ–¹æ³•

### 2. `backend/media/serializers.py`
- **ä¿ç•™**ï¼šæ‰€æœ‰åºåˆ—åŒ–å™¨çµæ§‹
- **ç§»é™¤**ï¼š`to_representation()` æ–¹æ³•ä¸­çš„åœ–ç‰‡è½‰æ› URL é‚è¼¯
  - ä¸å†ç”¢ç”Ÿ thumbnail_urlã€medium_urlã€large_url ç­‰
- **ä¿ç•™**ï¼šä¸Šå‚³åºåˆ—åŒ–å™¨çµæ§‹ï¼Œä½†åŠ ä¸Šè¨»è§£èªªæ˜æš«æ™‚åœç”¨

### 3. `backend/media/views.py`
- **ä¿ç•™**ï¼šæ‰€æœ‰ API ç«¯é»çµæ§‹
- **ç§»é™¤**ï¼šæ‰€æœ‰å¯¦éš›çš„åœ–ç‰‡ä¸Šå‚³é‚è¼¯
- **ä¿®æ”¹**ï¼šæ‰€æœ‰ç«¯é»ç¾åœ¨å›å‚³ã€ŒåŠŸèƒ½æš«æ™‚åœç”¨ã€çš„éŒ¯èª¤è¨Šæ¯ï¼ˆHTTP 503ï¼‰
- **ç§»é™¤**ï¼šCloudinaryService çš„æ‰€æœ‰å¼•ç”¨

### 4. `backend/gradProject/settings.py`
- **ç§»é™¤**ï¼šcloudinary ç›¸é—œçš„å°å…¥
  - `import cloudinary`
  - `import cloudinary.uploader`
  - `import cloudinary.api`
- **ç§»é™¤**ï¼šINSTALLED_APPS ä¸­çš„ cloudinary æ‡‰ç”¨ç¨‹å¼
  - `'cloudinary'`
  - `'cloudinary_storage'`
- **ç§»é™¤**ï¼šCloudinary é…ç½®
  - `CLOUDINARY_STORAGE` è¨­å®š
  - `cloudinary.config()` åˆå§‹åŒ–
  - `DEFAULT_FILE_STORAGE` è¨­å®š
- **ä¿ç•™**ï¼šåŸºæœ¬çš„åª’é«”æª”æ¡ˆé…ç½®ï¼ˆä½¿ç”¨æœ¬åœ°å„²å­˜ï¼‰

## ä¿ç•™çš„åŠŸèƒ½

### è³‡æ–™åº«çµæ§‹
- âœ… Image æ¨¡å‹ï¼ˆé€šç”¨åœ–ç‰‡ï¼‰
- âœ… UserHeadshot æ¨¡å‹ï¼ˆç”¨æˆ¶é ­åƒï¼‰
- âœ… PetHeadshot æ¨¡å‹ï¼ˆå¯µç‰©é ­åƒï¼‰
- âœ… æ‰€æœ‰æ¬„ä½ï¼ˆç‚ºæœªä¾†é›²ç«¯å„²å­˜é ç•™ï¼‰

### API ç«¯é»
- âœ… `POST /api/v1/media/upload/` - é€šç”¨åœ–ç‰‡ä¸Šå‚³ï¼ˆæš«åœï¼‰
- âœ… `POST /api/v1/media/avatar/` - ç”¨æˆ¶é ­åƒä¸Šå‚³ï¼ˆæš«åœï¼‰
- âœ… `POST /api/v1/media/pets/{pet_id}/photos/` - å¯µç‰©ç…§ç‰‡ä¸Šå‚³ï¼ˆæš«åœï¼‰
- âœ… `DELETE /api/v1/media/images/{image_id}/` - åœ–ç‰‡åˆªé™¤ï¼ˆæš«åœï¼‰

### åºåˆ—åŒ–å™¨
- âœ… ImageSerializer
- âœ… UserHeadshotSerializer
- âœ… PetHeadshotSerializer
- âœ… æ‰€æœ‰ä¸Šå‚³åºåˆ—åŒ–å™¨

## ç›®å‰ç‹€æ…‹

- ğŸ”´ **åœ–ç‰‡ä¸Šå‚³åŠŸèƒ½**ï¼šå·²åœç”¨ï¼Œæ‰€æœ‰ç«¯é»å›å‚³ HTTP 503
- ğŸŸ¢ **è³‡æ–™åº«çµæ§‹**ï¼šå®Œæ•´ä¿ç•™ï¼Œå¯éš¨æ™‚é‡æ–°å•Ÿç”¨
- ğŸŸ¢ **API ç«¯é»**ï¼šçµæ§‹å®Œæ•´ï¼Œç­‰å¾…æ–°çš„é›²ç«¯å„²å­˜å¯¦ä½œ
- ğŸŸ¡ **ç¾æœ‰åœ–ç‰‡**ï¼šè³‡æ–™åº«è¨˜éŒ„ä¿ç•™ï¼Œä½†å¯èƒ½ç„¡æ³•æ­£å¸¸é¡¯ç¤º

## å¾ŒçºŒæ­¥é©Ÿ

1. **é¸æ“‡æ–°çš„é›²ç«¯å„²å­˜æœå‹™**ï¼ˆAWS S3ã€Google Cloud Storageã€Azure Blob Storage ç­‰ï¼‰
2. **å¯¦ä½œæ–°çš„å„²å­˜æœå‹™é¡åˆ¥**ï¼ˆé¡ä¼¼åŸæœ¬çš„ CloudinaryServiceï¼‰
3. **æ¢å¾©ä¸Šå‚³é‚è¼¯**ï¼ˆåœ¨ views.py ä¸­ï¼‰
4. **æ¢å¾©åœ–ç‰‡è½‰æ›åŠŸèƒ½**ï¼ˆåœ¨ serializers.py ä¸­ï¼‰
5. **æ›´æ–°è¨­å®šæª”**ï¼ˆåœ¨ settings.py ä¸­ï¼‰

## æ³¨æ„äº‹é …

- ç›®å‰å‰ç«¯å˜—è©¦ä¸Šå‚³åœ–ç‰‡æœƒæ”¶åˆ° 503 éŒ¯èª¤
- ç¾æœ‰çš„åœ–ç‰‡ URL å¯èƒ½å¤±æ•ˆï¼ˆå¦‚æœæ˜¯ Cloudinary URLï¼‰
- è³‡æ–™åº«ä¸­çš„åœ–ç‰‡è¨˜éŒ„ä»ç„¶å­˜åœ¨ï¼Œå¯ç”¨æ–¼è³‡æ–™ç§»è½‰ 